<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="Values" href="values.html"><link rel="prev" title="Install" href="index.html">
        <link rel="prefetch" href="_static/redun.svg" as="image">

    <link rel="shortcut icon" href="_static/redun-no-text.svg"><!-- Generated with Sphinx 8.1.3 and Furo 2025.09.25 -->
        <title>Design overview - redun documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">redun  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/redun.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">redun  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Design overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="values.html">Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="executors.html">Executors</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduler.html">Scheduling redun workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Backend and database</a></li>
<li class="toctree-l1"><a class="reference internal" href="filesystems.html">Filesystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="tags.html">Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="spark.html">Spark</a></li>
<li class="toctree-l1"><a class="reference internal" href="typing.html">Type checking</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html">Console (TUI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="context.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developing.html">Developer guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Implementation notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="implementation/evaluation.html">Computational model</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementation/graph_reduction_caching.html">Graph reduction caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementation/hashing.html">Content addressable hashing summary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="redun/modules.html">API docs</a><input aria-label="Toggle navigation of API docs" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="redun/redun.html">redun package</a><input aria-label="Toggle navigation of redun package" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="redun/redun.backends.html">redun.backends package</a><input aria-label="Toggle navigation of redun.backends package" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="redun/redun.backends.db.html">redun.backends.db package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="redun/redun.console.html">redun.console package</a></li>
<li class="toctree-l3"><a class="reference internal" href="redun/redun.executors.html">redun.executors package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/insitro/redun">GitHub repository</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/design.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="design-overview">
<h1>Design overview<a class="headerlink" href="#design-overview" title="Link to this heading">¶</a></h1>
<p>Here, we describe the high-level design features of redun.</p>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h2>
<p>The goal of redun is to provide the benefits of workflow engines for Python code in an easy and unintrusive way. Workflow engines can help run code faster by using parallel distributed execution, they can provide checkpointing for fast resuming of previously halted execution, they can reactively re-execute code based on changes in data or code, and can provide logging for data provenance.</p>
<p>While there are <a class="reference external" href="https://github.com/pditommaso/awesome-pipeline">A LOT</a> of workflow engines available even for Python, redun differs by avoiding the need to restructure programs in terms of dataflow. In fact, we take the position that writing dataflows directly is unnecessarily restrictive, and by doing so we lose abstractions we have come to rely on in most modern high-level languages (control flow, recursion, higher order functions, etc). redun’s key insight is that workflows can be expressed as lazy expressions, that are then evaluated by a scheduler that performs automatic parallelization, caching, and data provenance logging.</p>
<p>redun’s key features are:</p>
<ul class="simple">
<li><p>Workflows are defined by lazy expressions that when evaluated emit dynamic directed acyclic graphs (DAGs), enabling complex data flows.</p></li>
<li><p>Incremental computation that is reactive to both data changes as well as code changes.</p></li>
<li><p>Workflow tasks can be executed on a variety of compute backend (threads, processes, AWS batch jobs, Spark jobs, etc).</p></li>
<li><p>Data changes are detected for in memory values as well as external data sources such as files and object stores using file hashing.</p></li>
<li><p>Code changes are detected by hashing individual Python functions and comparing against historical call graph recordings.</p></li>
<li><p>Past intermediate results are cached centrally and reused across workflows.</p></li>
<li><p>Past call graphs can be used as a data lineage record and can be queried for debugging and auditing.</p></li>
</ul>
<p>See the <a class="reference internal" href="#influences">influences</a> for more details on how these features relate to other tools.</p>
</section>
<section id="first-example">
<h2>First example<a class="headerlink" href="#first-example" title="Link to this heading">¶</a></h2>
<p>redun augments Python to simulate a functional language with lazy evaluation. By writing code as pure functions without side-effects, redun can safely perform parallel execution and cache function results. By using <a class="reference internal" href="#lazy-evaluation-and-parallelism">lazy evaluation</a>, we can execute a Python program quickly to automatically discover the dataflow between functions. Therefore, it is unnecessary to force the developer to specify the dataflow directly (e.g. Airflow’s <code class="docutils literal notranslate"><span class="pre">set_upstream()</span></code> and <code class="docutils literal notranslate"><span class="pre">set_downstream()</span></code>).</p>
<p>redun does not try to impose a functional style on all code. Python supports multiple programming paradigms and a typical project might include libraries that make use of all of them. Therefore, redun allows the user to annotate which functions are effectively pure using a <code class="docutils literal notranslate"><span class="pre">&#64;task</span></code> decorator. Such functions are called Tasks and they are the main unit of execution in redun. Tasks have several special properties that make them a powerful building block for data pipelines.</p>
<p>Here, is a small hello world program for redun:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># hello_world.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">redun</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">Scheduler</span>

<span class="n">redun_namespace</span> <span class="o">=</span> <span class="s2">&quot;hello_world&quot;</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_planet</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;World&quot;</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">greeter</span><span class="p">(</span><span class="n">greet</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">thing</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">greet</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">greet</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">greeter</span><span class="p">(</span><span class="n">greet</span><span class="p">,</span> <span class="n">get_planet</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">Scheduler</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>It could be executed as a regular Python script:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>hello_world.py
<span class="c1"># Which prints:</span>
Hello,<span class="w"> </span>World!
</pre></div>
</div>
<p>Or it can be executed with the <code class="docutils literal notranslate"><span class="pre">redun</span></code> command-line program:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>redun<span class="w"> </span>run<span class="w"> </span>hello_world.py<span class="w"> </span>main
<span class="c1"># Which prints:</span>
<span class="s1">&#39;Hello, World!&#39;</span>
</pre></div>
</div>
<p>There is nothing special about the <code class="docutils literal notranslate"><span class="pre">main()</span></code> task, we could call any task from the command line:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>redun<span class="w"> </span>run<span class="w"> </span>hello_world.py<span class="w"> </span>greeter<span class="w"> </span>--greet<span class="w"> </span>Hello<span class="w"> </span>--thing<span class="w"> </span><span class="s2">&quot;Mars&quot;</span>
<span class="c1"># Which prints:</span>
<span class="s1">&#39;Hello, Mars!&#39;</span>
</pre></div>
</div>
</section>
<section id="key-features">
<h2>Key features<a class="headerlink" href="#key-features" title="Link to this heading">¶</a></h2>
<section id="memoization-and-reactivity">
<h3>Memoization and reactivity<a class="headerlink" href="#memoization-and-reactivity" title="Link to this heading">¶</a></h3>
<p>The return values of tasks are memoized. When calling the same task with the same arguments, a previously cached result is used instead of re-executing the task. This allows us to quickly resume a past execution, by fast forwarding through old parts of a program and only executing new parts.</p>
<p>Consider the example above, which is also available in <code class="docutils literal notranslate"><span class="pre">examples/hello_world.py</span></code>. On first execution, every task executes as indicated by the “[redun] Run” log lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redun</span> <span class="n">run</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">py</span> <span class="n">main</span>

<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">main</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="mi">8</span><span class="n">cc26021</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Run</span> <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;greet&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello&#39;</span><span class="p">})</span> <span class="n">on</span> <span class="n">default</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">get_planet</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="n">e9a65320</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Run</span> <span class="n">get_planet</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span> <span class="n">on</span> <span class="n">default</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">greeter</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="mi">6447887</span><span class="n">f</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Run</span> <span class="n">greeter</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="s1">&#39;World&#39;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span> <span class="n">on</span> <span class="n">default</span>
<span class="s1">&#39;Hello, World!&#39;</span>
</pre></div>
</div>
<p>If we run a second time, all of the tasks will be cached (memoized) and will be fast-forwarded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redun</span> <span class="n">run</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">py</span> <span class="n">main</span>

<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">main</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="mi">8</span><span class="n">cc26021</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">get_planet</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="n">e9a65320</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">greeter</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="mi">6447887</span><span class="n">f</span><span class="p">)</span><span class="o">...</span>
<span class="s1">&#39;Hello, World!&#39;</span>
</pre></div>
</div>
<p>However, if we run with a new input argument, redun will detect that some tasks (<code class="docutils literal notranslate"><span class="pre">main</span></code>, <code class="docutils literal notranslate"><span class="pre">greeter</span></code>) do need to be re-executed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redun</span> <span class="n">run</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">py</span> <span class="n">main</span> <span class="o">--</span><span class="n">greet</span> <span class="n">Hi</span>

<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">main</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="n">ff5c0bea</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Run</span> <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;greet&#39;</span><span class="p">:</span> <span class="s1">&#39;Hi&#39;</span><span class="p">})</span> <span class="n">on</span> <span class="n">default</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">get_planet</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="n">e9a65320</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">greeter</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="n">ce5daced</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Run</span> <span class="n">greeter</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">,</span> <span class="s1">&#39;World&#39;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span> <span class="n">on</span> <span class="n">default</span>
<span class="s1">&#39;Hi, World!&#39;</span>
</pre></div>
</div>
<p>Also, notice that <code class="docutils literal notranslate"><span class="pre">get_planet()</span></code> did not need to be run again, because it arguments <code class="docutils literal notranslate"><span class="pre">()</span></code> are unchanged.</p>
<p>redun not only reacts to new input data changes, but it can also react to new <em>code changes</em>. Say we updated <code class="docutils literal notranslate"><span class="pre">get_planet()</span></code> to</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_planet</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Venus&#39;</span>
</pre></div>
</div>
<p>If we run redun again, redun will detect that <code class="docutils literal notranslate"><span class="pre">get_planet()</span></code> needs to run again because its code has changed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redun</span> <span class="n">run</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">py</span> <span class="n">main</span>

<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">main</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="mi">8</span><span class="n">cc26021</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">get_planet</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="n">f01c0932</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Run</span> <span class="n">get_planet</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span> <span class="n">on</span> <span class="n">default</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">greeter</span> <span class="p">(</span><span class="n">eval_hash</span><span class="o">=</span><span class="mf">0e90</span><span class="n">d651</span><span class="p">)</span><span class="o">...</span>
<span class="p">[</span><span class="n">redun</span><span class="p">]</span> <span class="n">Run</span> <span class="n">greeter</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span> <span class="n">on</span> <span class="n">default</span>
<span class="s1">&#39;Hello, Venus!&#39;</span>
</pre></div>
</div>
<p>How is this achieved? To make this memoization work, we need to know whether we have seen the same Task called with the same arguments. redun performs <a class="reference internal" href="tasks.html#task-hashing"><span class="std std-ref">hashing of Tasks</span></a> (see below) and arguments and uses those hashes as a cache key for fetching values from a result cache.</p>
</section>
<section id="lazy-evaluation-and-parallelism">
<h3>Lazy evaluation and parallelism<a class="headerlink" href="#lazy-evaluation-and-parallelism" title="Link to this heading">¶</a></h3>
<p>Tasks are executed in a lazy and asynchronous manner. When a task is called, it returns immediately with an <code class="docutils literal notranslate"><span class="pre">Expression</span></code> object:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">redun</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="c1"># &lt;class &#39;redun.expression.TaskExpression&#39;&gt;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># add(10, y=3)</span>
</pre></div>
</div>
<p>This expression means, “apply Task ‘add’ to arguments <code class="docutils literal notranslate"><span class="pre">10</span></code> and <code class="docutils literal notranslate"><span class="pre">y=3</span></code>”. Expressions are evaluated to their concrete values by the redun scheduler:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">redun</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scheduler</span>

<span class="n">scheduler</span> <span class="o">=</span> <span class="n">Scheduler</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scheduler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)))</span>
<span class="c1"># 13</span>
</pre></div>
</div>
<p>To build up a larger program, these Expression objects can be used as arguments to other Tasks, such as:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
<span class="c1"># add(add(1, 2), add(3, 4)) : type TaskExpresion</span>
</pre></div>
</div>
<p>This gives us a tree of expressions, and more generally they can be Directed Acyclic Graphs (DAGs).</p>
<p>The redun scheduler analyzes these expression DAGs in order to determine in which order tasks need to be executed and which are safe to execute in parallel. For example, take the following program:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assume step1, step2a, step2b are Tasks.</span>
<span class="c1"># Assume data is already defined.</span>

<span class="n">result1</span> <span class="o">=</span> <span class="n">step1</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">result2a</span> <span class="o">=</span> <span class="n">step2a</span><span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">result2b</span> <span class="o">=</span> <span class="n">step2b</span><span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">result3</span> <span class="o">=</span> <span class="n">step3</span><span class="p">(</span><span class="n">result2a</span><span class="p">,</span> <span class="n">result2b</span><span class="p">)</span>
</pre></div>
</div>
<p>redun would execute all four lines immediately, deferring execution of the implementations of the steps (i.e., it doesn’t call the body of the tasks), and builds up the following DAG of Tasks and Expressions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">--&gt;</span> <span class="n">step1</span> <span class="o">--&gt;</span> <span class="n">result1</span> <span class="o">--&gt;</span> <span class="n">step2a</span> <span class="o">--&gt;</span> <span class="n">result2a</span> <span class="o">---&gt;</span> <span class="n">step3</span> <span class="o">--</span> <span class="n">result3</span>
                         \                          <span class="o">/</span>
                          \<span class="o">--&gt;</span> <span class="n">step2b</span> <span class="o">--&gt;</span> <span class="n">result2b</span> <span class="o">/</span>
</pre></div>
</div>
<p>redun will notice that <code class="docutils literal notranslate"><span class="pre">step2a</span></code> and <code class="docutils literal notranslate"><span class="pre">step2b</span></code> are safe to execute in parallel in separate threads (or processes, batch jobs, etc).</p>
<p>Every argument of a task can be a concrete value (e.g. <code class="docutils literal notranslate"><span class="pre">10</span></code>, <code class="docutils literal notranslate"><span class="pre">'red'</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code>, a DataFrame, etc) or a lazy Expression of a value (e.g. <code class="docutils literal notranslate"><span class="pre">result1</span></code>). Just before a task executes, any arguments that were Expressions are resolved and replaced with concrete values. A task can also return an Expression received from subtasks as if it were a concrete value.</p>
<p>Working with lazy expressions requires some changes to how programs are structured. Briefly, once you have an Expression, the only way to “look inside” it, is to pass it to another task.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">step1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">adder</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="c1"># Arguments, such as `values` here, are always guaranteed to be concrete values.</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">step1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">step1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">step1</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="c1"># `results` is now a list of Expressions.</span>
    <span class="c1"># To add them together we need to pass them to another task.</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
<p>For those who are familiar with <a class="reference external" href="https://en.wikipedia.org/wiki/Futures_and_promises">Promises</a> from other languages such as javascript, redun tasks perform the equivalent Promise manipulations:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// This call</span>
<span class="nx">result2a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step2a</span><span class="p">(</span><span class="nx">result1</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="c1">// is equivalent to</span>
<span class="nx">result2a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result1</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">step2a</span><span class="p">(</span><span class="nx">result1</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// This call</span>
<span class="nx">result3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step3</span><span class="p">(</span><span class="nx">result2a</span><span class="p">,</span><span class="w"> </span><span class="nx">result2b</span><span class="p">)</span>
<span class="c1">// is equivalent to</span>
<span class="nx">result3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">result2a</span><span class="p">,</span><span class="w"> </span><span class="nx">result2b</span><span class="p">]).</span><span class="nx">then</span><span class="p">(([</span><span class="nx">result2a</span><span class="p">,</span><span class="w"> </span><span class="nx">result2b</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">step3</span><span class="p">(</span><span class="nx">result2a</span><span class="p">,</span><span class="w"> </span><span class="nx">result2b</span><span class="p">))</span>
</pre></div>
</div>
<p>Our use of Expressions to build up Task dependency is also similar to <a class="reference external" href="https://docs.python.org/dev/library/concurrent.futures.html">Concurrent Futures in Python</a> and <a class="reference external" href="https://docs.dask.org/en/latest/delayed.html">Dask Delayed</a>.</p>
</section>
<section id="tasks-as-pure-functions">
<h3>Tasks as pure functions<a class="headerlink" href="#tasks-as-pure-functions" title="Link to this heading">¶</a></h3>
<p>In order for redun to safely cache results and execute tasks in parallel, a few restrictions must be followed when writing a task. Primarily, tasks must be written such that they are “effectively <a class="reference external" href="https://en.wikipedia.org/wiki/Pure_function">pure functions</a>”. That is, given the same arguments, a task should always return (effectively) the same result. redun does not try to enforce strict purity, so minor side-effects such logging, or caching, are not an issue. A task can even be stochastic as long as the user is ok with using cached results from previous executions.</p>
<p>Tasks are allowed to call other tasks, just like one would write a function to call other functions. In fact, this is the encouraged way of building up a workflow program. Tasks are also allowed to call plain Python functions, as long as the net result of the task is effectively pure. You may also call tasks from plain Python functions as well. In fact, this often occurs when using functions such as <code class="docutils literal notranslate"><span class="pre">map()</span></code>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">small_helper</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="c1"># Small plain Python code...</span>
    <span class="k">return</span> <span class="n">item2</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="c1"># Process an item...</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">small_helper</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_items</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">process_item</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>
</pre></div>
</div>
<p>One point of caution about using plain Python functions is that redun cannot hash the contents of a plain Python function, such as <code class="docutils literal notranslate"><span class="pre">small_helper</span></code> above. So changes to that function will not trigger re-execution. It becomes the responsibility of the user to force re-execution if needed, perhaps by bumping the version of the calling task or explicitly indicating the dependency to Redun (see <a class="reference internal" href="tasks.html#task-hashing"><span class="std std-ref">Task Hashing</span></a> for more).</p>
</section>
<section id="result-caching">
<h3>Result caching<a class="headerlink" href="#result-caching" title="Link to this heading">¶</a></h3>
<p>As Redun’s scheduler traverses the lazy expression graphs, it looks for opportunities to rely on cached values to avoid repeating computations it has already performed. Redun’s approach to this is designed to be both efficient and correct. For more information on caching and scheduling, see (scheduler)[scheduler.md]. To illustrate how this works, and some of the subtleties therein, consider this example:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">step1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">step2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">step1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">step2</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result2</span>
</pre></div>
</div>
<p>When we execute <code class="docutils literal notranslate"><span class="pre">main(10)</span></code>, we get the result <code class="docutils literal notranslate"><span class="pre">(10</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">=</span> <span class="pre">22</span></code>.</p>
<p>Now, say we updated <code class="docutils literal notranslate"><span class="pre">step1</span></code> to be:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">step1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The correct answer to re-executing <code class="docutils literal notranslate"><span class="pre">main(10)</span></code> should be <code class="docutils literal notranslate"><span class="pre">((10</span> <span class="pre">+</span> <span class="pre">2)</span> <span class="pre">*</span> <span class="pre">2)</span> <span class="pre">=</span> <span class="pre">24</span></code>, however, overly simplistic result caching could miss the need to re-execute. After all, the code for <code class="docutils literal notranslate"><span class="pre">main</span></code> has not been changed (it’s still version=’1’) and neither have its arguments, <code class="docutils literal notranslate"><span class="pre">10</span></code>. In order to handle such cases correctly, redun walks the expression graph, looking for caching opportunities at each step.</p>
<p>On the first execution of <code class="docutils literal notranslate"><span class="pre">scheduler.run(main(10))</span></code>:</p>
<ul class="simple">
<li><p>The scheduler considers <code class="docutils literal notranslate"><span class="pre">main(10)</span></code> as an Expression <code class="docutils literal notranslate"><span class="pre">TaskExpression('main',</span> <span class="pre">(10,),</span> <span class="pre">{})</span></code>.</p></li>
<li><p>It first creates a cache key <code class="docutils literal notranslate"><span class="pre">(task=main,</span> <span class="pre">version='1',</span> <span class="pre">args=10)</span></code> and uses it to look up in a key-value store whether a previous result for this task call has been recorded. As this is our first execution, it will be a cache miss.</p></li>
<li><p>The function <code class="docutils literal notranslate"><span class="pre">main(10)</span></code> is executed, and its initial result is an Expression tree: <code class="docutils literal notranslate"><span class="pre">TaskExpression('step2',</span> <span class="pre">(TaskExpression('step1',</span> <span class="pre">(10,)</span> <span class="pre">{}),),</span> <span class="pre">{})</span></code>.</p></li>
<li><p>The <em>expression tree itself</em> is cached for the cache key <code class="docutils literal notranslate"><span class="pre">(task=main,</span> <span class="pre">version='1',</span> <span class="pre">args=10)</span></code>.</p></li>
<li><p>The redun scheduler proceeds to evaluate the Expression tree, calling task <code class="docutils literal notranslate"><span class="pre">step1(10)</span></code> and then <code class="docutils literal notranslate"><span class="pre">step2(11)</span></code>.</p></li>
<li><p>Each of their results is cached with cache keys indicating the task, task version/hash, and arguments.</p></li>
<li><p>Ultimately the scheduler returns concrete value <code class="docutils literal notranslate"><span class="pre">22</span></code>.</p></li>
</ul>
<p>For the second execution, with version=’2’ for step1, we have:</p>
<ul class="simple">
<li><p>The scheduler considers <code class="docutils literal notranslate"><span class="pre">main(10)</span></code> as an Expression <code class="docutils literal notranslate"><span class="pre">TaskExpression('main',</span> <span class="pre">(10,),</span> <span class="pre">{})</span></code>.</p></li>
<li><p>It creates a cache key <code class="docutils literal notranslate"><span class="pre">(task=main,</span> <span class="pre">version='1',</span> <span class="pre">args=10)</span></code> and finds a cache hit, namely <code class="docutils literal notranslate"><span class="pre">TaskExpression('step2',</span> <span class="pre">(TaskExpression('step1',</span> <span class="pre">(10,)</span> <span class="pre">{}),),</span> <span class="pre">{})</span></code>.</p></li>
<li><p>Due to having a cached result, the scheduler skips executing the function <code class="docutils literal notranslate"><span class="pre">main(10)</span></code>, and proceeds to evaluate the expression tree.</p></li>
<li><p>When the scheduler evaluates <code class="docutils literal notranslate"><span class="pre">TaskExpression('step1',</span> <span class="pre">(10,)</span> <span class="pre">{}),)</span></code>, it notices that the cache key <code class="docutils literal notranslate"><span class="pre">(task=step1,</span> <span class="pre">version='2',</span> <span class="pre">args=10)</span></code> has not been seen before, and so it executes <code class="docutils literal notranslate"><span class="pre">step1(10)</span></code> to get the result <code class="docutils literal notranslate"><span class="pre">12</span></code>.</p></li>
<li><p>The second sub-expression <code class="docutils literal notranslate"><span class="pre">TaskExpression('step2',</span> <span class="pre">(12,),</span> <span class="pre">{})</span></code> has also not been seen before, and so it executes as well.</p></li>
<li><p>Ultimately the scheduler returns the concrete value <code class="docutils literal notranslate"><span class="pre">24</span></code>.</p></li>
</ul>
<p>The end result of this process is that redun correctly skips re-execution of unchanged high level tasks, such as <code class="docutils literal notranslate"><span class="pre">main</span></code>, but properly re-executes updated deeply nested tasks, such as <code class="docutils literal notranslate"><span class="pre">step1</span></code>. It is quite common in large programs that the upper level tasks mostly perform routing of arguments and results, and the lower level tasks perform the actual work. Routing frequently is unaffected by the actual data or implementations of the lower level tasks, so being able to skip re-execution of high level tasks is an important optimization.</p>
</section>
<section id="file-reactivity">
<h3>File reactivity<a class="headerlink" href="#file-reactivity" title="Link to this heading">¶</a></h3>
<p>A common use case for workflow engines is to read and write to files, either stored locally or remotely (object storage, S3, etc). Files can be a tricky data type to accommodate in a purely functional setting because the contents of files can change outside of our control. Ideally, we would like our workflow engine to react to those changes. For example, we would want to re-execute our workflow when:</p>
<ul class="simple">
<li><p>An input file changes its contents, and now we want to re-execute the tasks that read that input file so we can regenerate our downstream results.</p></li>
<li><p>An output file has changed or been deleted, and now we want to re-execute the task that wrote that file so that we can reproduce the output file.</p></li>
</ul>
<p>These behaviors are what we typically get from a workflow engine like <code class="docutils literal notranslate"><span class="pre">make</span></code>. Changing a C source code file gets detected by <code class="docutils literal notranslate"><span class="pre">make</span></code> and it recompiles the source file. Deleting the final compiled program, forces <code class="docutils literal notranslate"><span class="pre">make</span></code> to regenerate the program from earlier steps (source compiling, object linking, etc). In data science workflows, we would often like to re-execute a calculation when the input CSV changes, or if an output plot was deleted or altered.</p>
<p>redun achieves this behavior by wrapping file input/output (IO) in a special class called <code class="docutils literal notranslate"><span class="pre">redun.File</span></code>. Here, is an example usage:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">redun</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">File</span>

<span class="n">redun_namespace</span> <span class="o">=</span> <span class="s2">&quot;examples.files&quot;</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_data</span><span class="p">(</span><span class="n">input_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">input_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">infile</span><span class="p">))</span>

    <span class="c1"># result = calculation with rows...</span>

    <span class="n">output_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;output.txt&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">output</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_file</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">input_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;input.csv&#39;</span><span class="p">)</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_file</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">File()</span></code> constructor takes a path as an argument (it can be a local file or any <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/">fsspec</a> supported remote URL, such as S3 or GCP.) and provides familiar file IO methods such as <code class="docutils literal notranslate"><span class="pre">open()</span></code> and <code class="docutils literal notranslate"><span class="pre">close()</span></code>. <code class="docutils literal notranslate"><span class="pre">open()</span></code> gives a usual file stream that we can read or write from. The special logic happens when a File is returned from a task or passed as an argument. In those situations, the File is hashed and the File reference is recorded in the call graph. By default, redun performs a fast pseudo hashing of a file by hashing the triple (file path, byte size, modification time) (a technique used by other workflow engines, such as <a class="reference external" href="https://www.nextflow.io/">Nextflow</a>).</p>
<p>When a change is made to the input file <code class="docutils literal notranslate"><span class="pre">input.csv</span></code>, redun will notice that the File’s hash has changed and will consider it a new value that requires <code class="docutils literal notranslate"><span class="pre">process_data()</span></code> to re-execute. This is very similar to the caching logic for any other task argument.</p>
<p>However, if <code class="docutils literal notranslate"><span class="pre">output.txt</span></code> is deleted or altered, redun does something special. When redun retrieves from the call graph a previously cached <code class="docutils literal notranslate"><span class="pre">output_file</span></code> result, it compares the recorded hash with a new hash computed from the current file in the filesystem. If the hashes don’t match, the cached File is considered <em>invalid</em>, and it is considered a cache miss. This will force <code class="docutils literal notranslate"><span class="pre">process_data()</span></code> to re-execute.</p>
<p>We call File an example of an <em>External Value</em>, because Files can change in an external system, such as a file system outside our control. Consequently, when we fetch a File from the cache, we must first check whether it’s still valid (i.e. cached hash matches current hash from filesystem).</p>
<p>redun naturally understands which Files are used for input vs output based on whether they are passed as arguments or returned as results, respectively. Note, it can lead to confusing behavior to pass a File as input to a Task, alter it, and then return it as a result. That would lead to the recorded call node to be immediately out of date (its input File hash doesn’t match anymore). The user should be careful to avoid this pattern.</p>
<p>See the <a class="reference internal" href="values.html#validity"><span class="std std-ref">Validity</span></a> section below for additional discussion on the general feature.</p>
</section>
<section id="shell-scripting">
<h3>Shell scripting<a class="headerlink" href="#shell-scripting" title="Link to this heading">¶</a></h3>
<p>It is common, especially in bioinformatics, to use workflow engines to combine together unix programs into a computational pipeline. Typically, each program exchanges data with each other through input and output files. redun provides several features to ease the calling of programs through scripts and managing their input and output files.</p>
<section id="script-tasks">
<h4>Script tasks<a class="headerlink" href="#script-tasks" title="Link to this heading">¶</a></h4>
<p>A <em>script task</em> is a special task in redun whose definition is a shell script as opposed to a python function. Script tasks are defined by passing the task option <code class="docutils literal notranslate"><span class="pre">script=True</span></code> in the <code class="docutils literal notranslate"><span class="pre">&#64;task()</span></code> decorator and returning a string containing a shell script.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">task1</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    mkdir dir</span>
<span class="s2">    cd dir</span>
<span class="s2">    my-prog </span><span class="si">{</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arg2</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The user can use even use f-string interpolation to conveniently pass task arguments (e.g. <code class="docutils literal notranslate"><span class="pre">arg1</span></code> and <code class="docutils literal notranslate"><span class="pre">arg2</span></code>) to the script.</p>
<p>The return value of a script task is the standard output of the script. Here, is an example of a normal task, <code class="docutils literal notranslate"><span class="pre">grep_files()</span></code> calling a script task <code class="docutils literal notranslate"><span class="pre">grep()</span></code>:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">grep</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">File</span><span class="p">):</span>
    <span class="c1"># Calls grep to find pattern in a file.</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    grep </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">path</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">grep_files</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">File</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># Calls grep to find a pattern on a list of files.</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>  <span class="c1"># Result is stdout of `grep {pattern} {file.path}`</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">matches</span>
</pre></div>
</div>
<p>Scripts are assumed to be <code class="docutils literal notranslate"><span class="pre">sh</span></code> scripts by default, but custom interpreters (e.g. <code class="docutils literal notranslate"><span class="pre">python</span></code>) can be specified using <code class="docutils literal notranslate"><span class="pre">#!</span></code> in the first line.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">grep</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">File</span><span class="p">):</span>
    <span class="c1"># Calls grep to find pattern in a file.</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    #!/usr/bin/python</span>
<span class="s2">    print(&#39;Hello, World!&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Feel free to indent lines to match the surrounding code. redun uses <a class="reference external" href="https://docs.python.org/3/library/textwrap.html#textwrap.dedent">dedent()</a> to remove leading whitespace in scripts.</p>
</section>
<section id="file-staging">
<h4>File staging<a class="headerlink" href="#file-staging" title="Link to this heading">¶</a></h4>
<p>When defining script tasks that run on a remote execution environment (e.g. AWS Batch), it is common to have to copy input files from a cloud storage location (e.g. S3) to the compute node and similarly copy output files from the compute node back to cloud storage. We call this file staging and unstaging, respectively.</p>
<p>Manually performing file staging would look something like this:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">align_dna_reads_to_genome</span><span class="p">(</span><span class="n">input_reads_file</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">output_align_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        # Stage input file from cloud storage to compute node (local disk).</span>
<span class="s2">        aws s3 cp </span><span class="si">{</span><span class="n">input_reads_file</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2"> reads.fastq.gz</span>

<span class="s2">        # Run a unix program that processes input reads.fastq.gz and outputs sample.aln.bam</span>
<span class="s2">        run-bwamem </span><span class="se">\</span>
<span class="s2">            -R &quot;@RG</span><span class="se">\\</span><span class="s2">tID:</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="se">\\</span><span class="s2">tSM:</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="se">\\</span><span class="s2">tPL:illumina&quot; </span><span class="se">\</span>
<span class="s2">            -o sample </span><span class="se">\</span>
<span class="s2">            -H </span><span class="se">\</span>
<span class="s2">            genome.fa </span><span class="se">\</span>
<span class="s2">            reads.fastq.gz</span>

<span class="s2">        # Unstage output file back to cloud storage.       </span>
<span class="s2">        aws s3 cp sample.aln.bam </span><span class="si">{</span><span class="n">output_align_path</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Example of calling script task.</span>
    <span class="n">input_reads_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;s3://bucket/a/b/c/100.fastq.gz&#39;</span><span class="p">)</span>
    <span class="n">output_align_path</span> <span class="o">=</span> <span class="s1">&#39;s3://bucket/a/b/c/100.aln.bam&#39;</span>
    <span class="n">sample_id</span> <span class="o">=</span> <span class="s1">&#39;100&#39;</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">align_dna_reads_to_genome</span><span class="p">(</span><span class="n">input_reads_file</span><span class="p">,</span> <span class="n">output_align_path</span><span class="p">,</span> <span class="n">sample_id</span><span class="p">)</span>
    <span class="c1"># After execution, the file &#39;s3://bucket/a/b/c/100.aln.bam&#39; will be created.</span>
    <span class="k">return</span> <span class="n">stdout</span>
</pre></div>
</div>
<p>The above code should work perfectly fine, however, manually writing input/output staging commands can be tedious. redun provides a utility function <code class="docutils literal notranslate"><span class="pre">script()</span></code> that can further simplify file staging.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">redun</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">File</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">align_dna_reads_to_genome</span><span class="p">(</span><span class="n">input_reads_file</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">output_align_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        # Run a unix program that processes input reads.fastq.gz and outputs sample.aln.bam</span>
<span class="s2">        run-bwamem </span><span class="se">\</span>
<span class="s2">            -R &quot;@RG</span><span class="se">\\</span><span class="s2">tID:</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="se">\\</span><span class="s2">tSM:</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="se">\\</span><span class="s2">tPL:illumina&quot; </span><span class="se">\</span>
<span class="s2">            -o sample </span><span class="se">\</span>
<span class="s2">            -H </span><span class="se">\</span>
<span class="s2">            genome.fa </span><span class="se">\</span>
<span class="s2">            reads.fastq.gz</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">input_reads_file</span><span class="o">.</span><span class="n">stage</span><span class="p">(</span><span class="s1">&#39;reads.fastq.gz&#39;</span><span class="p">)],</span>
        <span class="n">outputs</span><span class="o">=</span><span class="n">File</span><span class="p">(</span><span class="n">output_align_path</span><span class="p">)</span><span class="o">.</span><span class="n">stage</span><span class="p">(</span><span class="s1">&#39;sample.aln.bam&#39;</span><span class="p">),</span>
   <span class="p">)</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Example of calling script task.</span>
    <span class="n">input_reads_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;s3://bucket/a/b/c/100.fastq.gz&#39;</span><span class="p">)</span>
    <span class="n">output_align_path</span> <span class="o">=</span> <span class="s1">&#39;s3://bucket/a/b/c/100.aln.bam&#39;</span>
    <span class="n">sample_id</span> <span class="o">=</span> <span class="s1">&#39;100&#39;</span>
    <span class="n">output_align_file</span> <span class="o">=</span> <span class="n">align_dna_reads_to_genome</span><span class="p">(</span><span class="n">input_reads_file</span><span class="p">,</span> <span class="n">output_align_path</span><span class="p">,</span> <span class="n">sample_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_align_file</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">script()</span></code> takes a shell script, plus two additional arguments <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code> that specify <code class="docutils literal notranslate"><span class="pre">StagingFile</span></code>s. A <code class="docutils literal notranslate"><span class="pre">StagingFile</span></code> is a pair of local and remote <code class="docutils literal notranslate"><span class="pre">File</span></code>s. <code class="docutils literal notranslate"><span class="pre">script()</span></code> will copy inputs from remote file to local file, and outputs from local file to remote file. <code class="docutils literal notranslate"><span class="pre">StagingFile</span></code>s can be defined using the <code class="docutils literal notranslate"><span class="pre">File.stage()</span></code> method:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">File</span><span class="p">(</span><span class="n">remote_path</span><span class="p">)</span><span class="o">.</span><span class="n">stage</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</pre></div>
</div>
<p>The final result of <code class="docutils literal notranslate"><span class="pre">script()</span></code> will be the same shape of <code class="docutils literal notranslate"><span class="pre">outputs</span></code>, with all <code class="docutils literal notranslate"><span class="pre">StagingFile</span></code>s replaced by their remote <code class="docutils literal notranslate"><span class="pre">File</span></code>s. This allows easy definition of multiple output files:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">redun</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">File</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">align_dna_reads_to_genome</span><span class="p">(</span>
        <span class="n">input_reads1_file</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span>
        <span class="n">input_reads2_file</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span>
        <span class="n">output_align_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_metrics_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sample_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
    <span class="k">return</span> <span class="n">script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        # Run a unix program that processes input reads.fastq.gz and outputs sample.aln.bam</span>
<span class="s2">        run-bwamem </span><span class="se">\</span>
<span class="s2">            -R &quot;@RG</span><span class="se">\\</span><span class="s2">tID:</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="se">\\</span><span class="s2">tSM:</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="se">\\</span><span class="s2">tPL:illumina&quot; </span><span class="se">\</span>
<span class="s2">            -o sample </span><span class="se">\</span>
<span class="s2">            -H </span><span class="se">\</span>
<span class="s2">            genome.fa </span><span class="se">\</span>
<span class="s2">            reads1.fastq.gz </span><span class="se">\</span>
<span class="s2">            reads2.fastq.gz</span>

<span class="s2">        # Collect some metrics about sample.aln.bam</span>
<span class="s2">        samtools depth -a sample.aln.bam &gt; sample.depth_out.txt</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
            <span class="n">input_reads1_file</span><span class="o">.</span><span class="n">stage</span><span class="p">(</span><span class="s1">&#39;reads1.fastq.gz&#39;</span><span class="p">)</span>
            <span class="n">input_reads2_file</span><span class="o">.</span><span class="n">stage</span><span class="p">(</span><span class="s1">&#39;reads2.fastq.gz&#39;</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">outputs</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="n">File</span><span class="p">(</span><span class="n">output_align_path</span><span class="p">)</span><span class="o">.</span><span class="n">stage</span><span class="p">(</span><span class="s1">&#39;sample.aln.bam&#39;</span><span class="p">),</span>
            <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="n">File</span><span class="p">(</span><span class="n">output_metrics_path</span><span class="p">)</span><span class="o">.</span><span class="n">stage</span><span class="p">(</span><span class="s1">&#39;sample.depth_out.txt&#39;</span><span class="p">),</span>
        <span class="p">}</span>
   <span class="p">)</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Example of calling script task.</span>
    <span class="n">input_reads1_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;s3://bucket/a/b/c/100.1.fastq.gz&#39;</span><span class="p">)</span>
    <span class="n">input_reads2_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;s3://bucket/a/b/c/100.2.fastq.gz&#39;</span><span class="p">)</span>
    <span class="n">output_align_path</span> <span class="o">=</span> <span class="s1">&#39;s3://bucket/a/b/c/100.aln.bam&#39;</span>
    <span class="n">output_metrics_path</span> <span class="o">=</span> <span class="s1">&#39;s3://bucket/a/b/c/100.depth_out.txt&#39;</span>
    <span class="n">sample_id</span> <span class="o">=</span> <span class="s1">&#39;100&#39;</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">align_dna_reads_to_genome</span><span class="p">(</span>
        <span class="n">input_reads1_file</span><span class="p">,</span> <span class="n">input_reads2_file</span><span class="p">,</span>
        <span class="n">output_align_path</span><span class="p">,</span> <span class="n">output_metrics_path</span><span class="p">,</span>
        <span class="n">sample_id</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Returns</span>
    <span class="c1"># {</span>
    <span class="c1">#    &#39;align&#39;: File(&#39;s3://bucket/a/b/c/100.aln.bam&#39;),</span>
    <span class="c1">#    &#39;metrics&#39;: File(&#39;s3://bucket/a/b/c/100.depth_out.txt&#39;),</span>
    <span class="c1"># }</span>

    <span class="c1"># Use lazy key access to pass only the alignment to another task.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">post_process_align</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;align&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</section>
</section>
<section id="provenance-and-call-graphs">
<h3>Provenance and call graphs<a class="headerlink" href="#provenance-and-call-graphs" title="Link to this heading">¶</a></h3>
<img src="_static/redun-call-graph.svg" width="100%"/>
<p>Depicted above is an example call graph and job tree (left) for an execution of a workflow (right). When each task is called, a CallNode is recorded along with all the Values used as arguments and return values. As tasks (<code class="docutils literal notranslate"><span class="pre">main</span></code>) call child tasks, children CallNodes are recorded (<code class="docutils literal notranslate"><span class="pre">task1</span></code> and <code class="docutils literal notranslate"><span class="pre">task2</span></code>). “Horizontal” dataflow is also recorded between sibling tasks, such as <code class="docutils literal notranslate"><span class="pre">task1</span></code> and <code class="docutils literal notranslate"><span class="pre">task2</span></code>. Each node in the call graph is identified by a unique hash and each Job and Execution is identified by a unique UUID. This information is stored by default in the redun database <code class="docutils literal notranslate"><span class="pre">.redun/redun.db</span></code>.</p>
<p>The redun backend database provides a durable record of these call graphs for every execution redun performs. This not only provides the backend storage for caching, it also is queryable by users to explore the call graph, using the <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">log</span></code>, <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">console</span></code>, and <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">repl</span></code> commands. For example, if we know that a file <code class="docutils literal notranslate"><span class="pre">/tmp/data</span></code> was produced by redun, we can find out exactly which execution did so, and hence can retrieve information about the code and inputs used to do so. See <a class="reference internal" href="db.html#querying-call-graphs"><span class="std std-ref">querying call graphs</span></a> for more.</p>
</section>
</section>
<section id="advanced-topics">
<h2>Advanced topics<a class="headerlink" href="#advanced-topics" title="Link to this heading">¶</a></h2>
<section id="working-with-databases-and-apis">
<h3>Working with databases and APIs<a class="headerlink" href="#working-with-databases-and-apis" title="Link to this heading">¶</a></h3>
<p>It’s common to use workflow engines to implement Extract Transform Load (ETL) pipelines which help move data between data stores such as databases, data lakes, and other services. Inevitably, we would need to work with ephemeral objects such as database connections and API clients that would have difficulties with caching and re-execution without providing special treatment. For example:</p>
<ul class="simple">
<li><p>Database connections or API clients might have internal state you don’t want to be serialized, such as secrets or overly specific configuration information (IP addresses, port numbers).</p></li>
<li><p>Connections would also have state such as socket file descriptors that won’t be valid when deserialized later on.</p></li>
<li><p>With files, we were able to double check if their current state was consistent with our cache by hashing them. With a database or API, it’s typically not feasible to hash a whole database. Is there something else we could do?</p></li>
<li><p>The redun cache contains cached results from all previous runs. Conveniently, that allows for fast reverting to old results if code or input data is changed back to the old state. However, for a stateful system like a database, we likely can’t just re-execute arbitrary tasks in any order. Similar to database migration frameworks (South, Alembic, etc), we may need to roll back past tasks before applying new ones.</p></li>
</ul>
<p>redun provides solutions to several of these challenges using a concept called <a class="reference internal" href="values.html#handles-for-ephemeral-and-stateful-values"><span class="std std-ref">Handles</span></a>.</p>
</section>
<section id="running-without-a-scheduler">
<h3>Running without a scheduler<a class="headerlink" href="#running-without-a-scheduler" title="Link to this heading">¶</a></h3>
<p>Redun is designed to execute workflows in a highly parallel and asynchronous manner. This allows
it to efficiently orchestrate complex workflows spread over a wide collection of resources.
If the workflow is configured to use remote resources, this can mean that the scheduler
sits idle, waiting for offloaded tasks to complete. However, having the long-lived scheduler
waiting for those results is central to the design of redun. We prioritized
keeping Executors as simple as possible, and instead rely on the scheduler to handle pre- and
post-execution tasks, like recording to the backend database and processing any downstream
tasks. Executors implement ways to offload computation to other resources or environments;
their implementations involve arranging for the tasks provided by the scheduler to be run,
then monitoring them (often in a long-lived thread) and notifying the scheduler when they
are finished.</p>
<p>There are a couple of instances where redun offers alternatives to this pattern, but they
come with compromises. First, the <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">launch</span></code> command line provides a lightweight way
to submit a command to a remote executor; most commonly, this is used to trigger redun itself,
such as <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">launch</span> <span class="pre">--executor</span> <span class="pre">batch</span> <span class="pre">redun</span> <span class="pre">run</span> <span class="pre">file.py</span> <span class="pre">mytask</span></code>. The launch command
offers an asynchronous mode, where it simply attempts to submit the job and exits. Not all
executors will actually work; the Docker and AWS Batch executors are the intended use case,
at the time of writing. When running asynchronously, the launcher doesn’t write to the database
at all.</p>
<p>Second, <code class="docutils literal notranslate"><span class="pre">subrun</span></code> shifts the execution by starting a child scheduler, which means that the
task is far more independent of the parent scheduler, able to interact with the backend and
resolve complex expressions or recursive tasks.</p>
<p>Third, federated task for submitting to a REST proxy is fire-and-forget; see
<a class="reference internal" href="tasks.html#federated-task"><span class="std std-ref">Federated task</span></a> It will trigger a
completely separate redun execution to occur, but it only provides the execution id back to the
caller. It doesn’t make sense for the REST proxy to be a full executor, since it’s not
capable enough to handle arbitrary tasks, by design it only handles federated tasks. Plus,
the proxy is not long-lived, and we don’t have any way for the caller to monitor for job
results.</p>
</section>
<section id="connections-to-functional-programming">
<h3>Connections to functional programming<a class="headerlink" href="#connections-to-functional-programming" title="Link to this heading">¶</a></h3>
<p>redun’s use of task decorators and lazy-evaluation can be thought of as a <a class="reference external" href="https://en.wikipedia.org/wiki/Monad_(functional_programming)">monad</a>. The redun monad consists of three components:</p>
<ul class="simple">
<li><p>A type constructor <code class="docutils literal notranslate"><span class="pre">M</span></code>:</p>
<ul>
<li><p>redun uses <code class="docutils literal notranslate"><span class="pre">Expression</span></code> to wrap user values (type <code class="docutils literal notranslate"><span class="pre">a</span></code>).</p></li>
</ul>
</li>
<li><p>A type converter <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">::</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">a</span></code>:</p>
<ul>
<li><p>redun uses <code class="docutils literal notranslate"><span class="pre">ExpressionValue(a)</span></code> to lift a user value into the monad. This is conceptually done automatically for the user.</p></li>
</ul>
</li>
<li><p>A combinator <code class="docutils literal notranslate"><span class="pre">bind</span> <span class="pre">::</span> <span class="pre">M</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">(a</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">b)</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">b</span></code>:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&#64;task()</span></code> decorator plays the role of <code class="docutils literal notranslate"><span class="pre">bind</span></code> although with the arguments reversed.</p></li>
</ul>
</li>
</ul>
<p>Let’s look at the following example:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">task1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">task2</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">task1</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The undecorated function <code class="docutils literal notranslate"><span class="pre">task2</span></code> is a monadic function and has type <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">b</span></code>, where <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are <code class="docutils literal notranslate"><span class="pre">int</span></code>. The return type is <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">b</span></code> because <code class="docutils literal notranslate"><span class="pre">task(y</span> <span class="pre">+</span> <span class="pre">1)</span></code> will return an <code class="docutils literal notranslate"><span class="pre">Expression</span></code> (<code class="docutils literal notranslate"><span class="pre">M</span></code>) wrapping an int (<code class="docutils literal notranslate"><span class="pre">b</span></code>).</p></li>
<li><p>We can think of decorator <code class="docutils literal notranslate"><span class="pre">&#64;task</span></code> as performing currying.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">task2</span></code> has type <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">b</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task(task2)</span></code> transforms the function to have type <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">b</span></code>, since decorated tasks can accept <code class="docutils literal notranslate"><span class="pre">Expressions</span></code> as arguments. For arguments that are concrete user values (type <code class="docutils literal notranslate"><span class="pre">a</span></code>), redun automatically wraps the arguments with <code class="docutils literal notranslate"><span class="pre">ValueExpression</span></code>, at least conceptually.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">task(task2)(ValueExpression(10))</span></code> is viewed as currying, we could write this as <code class="docutils literal notranslate"><span class="pre">task(task2,</span> <span class="pre">ValueExpression(10))</span></code> and <code class="docutils literal notranslate"><span class="pre">task</span></code> has type <code class="docutils literal notranslate"><span class="pre">(a</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">b)</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">M</span> <span class="pre">b</span></code>. This is very close to <code class="docutils literal notranslate"><span class="pre">bind</span></code> except with arguments reversed.</p></li>
</ul>
</li>
</ul>
<p>By using monads to wrap the computation, redun can analyze the dataflow between tasks and perform proper parallelization and scheduling transparently. By design, redun tries to leverage the benefits of monads and functional programming concepts, but in a style familiar to Python developers.</p>
<p>This section from the <a class="reference external" href="https://en.wikipedia.org/wiki/Monad_(functional_programming)">monad Wikipedia page</a> provides a good summary of why the monad is a natural fit for defining a workflow:</p>
<blockquote>
<div><p>The value of the monad pattern goes beyond merely condensing code and providing a link to mathematical reasoning. Whatever language or default programming paradigm a developer uses, following the monad pattern brings many of the benefits of purely functional programming. By reifying a specific kind of computation, a monad not only encapsulates the tedious details of that computational pattern, but it does so in a declarative way, improving the code’s clarity. As monadic values explicitly represent not only computed values but computed effects, a monadic expression can be substituted with its value in referentially transparent positions, much like pure expressions can be, allowing for many techniques and optimizations based on rewriting.[5]</p>
</div></blockquote>
<p>In our use, “reifying” means wrapping the computation into an expression tree that our scheduler can analyze for deciding which tasks can be executed safely in parallel, which tasks can be skipped due to caching, etc. Generating the expression tree is what makes redun <em>declarative</em>, even though we do execute imperative code to generate the expression tree.</p>
</section>
<section id="redun-a-language-within">
<h3>redun: a language within<a class="headerlink" href="#redun-a-language-within" title="Link to this heading">¶</a></h3>
<p>redun can be thought of as implementing an asynchronous functional programming language within Python, which is an imperative multi-paradigm language, a general pattern called <a class="reference external" href="https://en.wikipedia.org/wiki/Metaprogramming">metaprogramming</a>. This strategy for implementing a workflow engine allows us to use a very popular programming language, Python (used in data science, ML, web development, ETLs), but adapt it to have language features amenable to distributed computing. The following features map between Python and redun-the-language:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Task</span></code>s are the functions of redun.</p></li>
<li><p>Tasks are <a class="reference external" href="https://en.wikipedia.org/wiki/First-class_function">first-class values</a> in redun and therefore can be passed as arguments and returned as results from redun functions.</p></li>
<li><p>Task input arguments and outputs are the values of redun.</p>
<ul>
<li><p>In fact, the base class for classes like <code class="docutils literal notranslate"><span class="pre">File</span></code>, <code class="docutils literal notranslate"><span class="pre">Handle</span></code>, and <code class="docutils literal notranslate"><span class="pre">Task</span></code> is <code class="docutils literal notranslate"><span class="pre">Value</span></code>.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> is the interpreter and runtime of redun.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Expression</span></code> implements expressions in the redun language. The <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> recursively evaluates <code class="docutils literal notranslate"><span class="pre">Expression</span></code>s into concrete values.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">TaskRegistry</span></code> and <code class="docutils literal notranslate"><span class="pre">TypeRegistry</span></code> are the environment (described in <a class="reference external" href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Overview">Scope</a>) for redun.</p></li>
<li><p>Plain Python functions that take <code class="docutils literal notranslate"><span class="pre">Expression</span></code>s are like <a class="reference external" href="https://en.wikipedia.org/wiki/Macro_(computer_science)#Syntactic_macros">macros</a> since they are evaluated at “compile-time” (i.e. workflow construction-time).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scheduler_task</span></code>s are the equivalent of <a class="reference external" href="https://en.wikipedia.org/wiki/Fexpr">fexpr</a> and can be used to implement <a class="reference external" href="https://groups.csail.mit.edu/mac/ftpdir/scheme-7.4/doc-html/scheme_3.html">special forms</a> in redun.</p>
<ul>
<li><p>One could implement if-expressions (<code class="docutils literal notranslate"><span class="pre">cond</span></code>), try-except (<code class="docutils literal notranslate"><span class="pre">catch</span></code>), and <code class="docutils literal notranslate"><span class="pre">seq</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PartialTask</span></code> allows the creation of closures for redun, since they do not evaluate their arguments until all other arguments are supplied.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">PartialTask</span></code>s can be used to implement <code class="docutils literal notranslate"><span class="pre">delay</span></code> and <code class="docutils literal notranslate"><span class="pre">force</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="influences">
<h2>Influences<a class="headerlink" href="#influences" title="Link to this heading">¶</a></h2>
<p>The development of redun has been inspired by many projects. Here is a brief review of our understanding of how redun’s ideas relate to similar concepts seen elsewhere.</p>
<ul class="simple">
<li><p>Bioinformatic workflow languages: <a class="reference external" href="https://github.com/openwdl/wdl">WDL</a>, <a class="reference external" href="https://www.commonwl.org/">CWL</a>, <a class="reference external" href="https://www.nextflow.io/">Nextflow</a>, <a class="reference external" href="https://snakemake.readthedocs.io/en/stable/">Snakemake</a>, <a class="reference external" href="https://github.com/grailbio/reflow">Reflow</a></p>
<ul>
<li><p>Workflow languages such as these give special treatment to file and code change reactivity, which is especially helpful in scientific workflows that typically go through quick interactive development. redun’s <code class="docutils literal notranslate"><span class="pre">File</span></code> and task hashing were inspired by these languages.</p></li>
<li><p>Bioinformatic workflow languages are most commonly used to wrap unix programs that expect their input and output files to be local. Accordingly, these languages typically provide a specific syntax to help copy files from cloud storage to local disk and back, a process sometimes called staging or localization. This behavior inspired redun’s <code class="docutils literal notranslate"><span class="pre">File(remote_path).stage(local_path)</span></code> syntax. The need to make frequent calls to unix programs inspired the <code class="docutils literal notranslate"><span class="pre">script()</span></code> task.</p></li>
<li><p>They also all define a Domain Specific Language (DSL) in order to enforce pure functions or provide dedicated syntax for task dependency. redun differs by relying on a host language, Python. Using Python makes it difficult to enforce some of the same constraints (e.g. function purity), but it does allow redun workflows to more easily integrate with the whole world of Python data science libraries (e.g. Pandas, NumPy, pytorch, rdkit, sqlalchemy, etc) without layers of wrapping (e.g. driver scripts, data serializing/deserializing, Docker images).</p></li>
</ul>
</li>
<li><p>Data engineering workflow languages: <a class="reference external" href="https://airflow.apache.org/">Airflow</a>, <a class="reference external" href="https://github.com/spotify/luigi">Luigi</a>, <a class="reference external" href="https://www.prefect.io/">Prefect</a></p>
<ul>
<li><p>These workflow languages have had a more general focus beyond interacting with files. They are often used for ETLs (extract-transform-load) where data is exchanged with databases or web services. redun does not assume all dataflow is through files and so can used for interacting with databases and APIs as well.</p></li>
<li><p>Airflow v2, Prefect, and <a class="reference external" href="https://docs.dask.org/en/latest/delayed.html">Dask delayed</a> have adopted defining tasks as decorated Python functions, which when invoked return a Promise / Future / Delayed that can be passed as an argument to another task call. The workflow engine can then inspect the presence of these lazy objects in task call arguments in order to infer the edges of the workflow DAG. This allows very natural looking workflow definitions. redun uses the same approach but returns Expressions instead, which differ from other lazy values in several ways. First, the evaluation of an Expression can change depending on what larger Expression it belongs to, such as <code class="docutils literal notranslate"><span class="pre">cond()</span></code> or <code class="docutils literal notranslate"><span class="pre">catch()</span></code>. Second, Expressions are free to return more Expressions for evaluation. Third, redun will evaluate Expressions inside of Nested Values (list, dict, set, tuple, namedtuple, dataclass) by default.</p></li>
</ul>
</li>
<li><p>Expression hashing: <a class="reference external" href="https://www.unisonweb.org/">Unison</a>, <a class="reference external" href="https://github.com/StanfordSNR/gg">gg</a></p>
<ul>
<li><p>In Unison, every expression is hashable and the hash can be used as a cache key for replaying reductions / evaluations from a cache. This is similar to how redun represents a workflow as a graph of Expressions, each of which is hashed in order to consult a central cache (Value Store).</p></li>
<li><p>In gg, a workflow is defined as a graph of thunks (redun’s TaskExpression) which is evaluated using graph reduction. Each reduction is performed on a remote execution system such as AWS Lambda. redun is very similar, but also allows evaluating each Expression on a different Executor (e.g. threads, processes, Batch jobs, Spark jobs, etc).</p></li>
</ul>
</li>
<li><p>Functional programming languages: <a class="reference external" href="https://www.haskell.org/">Haskell</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a></p>
<ul>
<li><p>redun’s Scheduler can be seen as an interpreter for a <a class="reference internal" href="#redun-a-language-within">functional programming language</a>. Many of the builtin tasks take their name from similar functions in Haskell and Lisp: <code class="docutils literal notranslate"><span class="pre">map_</span></code>, <code class="docutils literal notranslate"><span class="pre">flat_map</span></code>, <code class="docutils literal notranslate"><span class="pre">seq</span></code>, <code class="docutils literal notranslate"><span class="pre">catch</span></code>, <code class="docutils literal notranslate"><span class="pre">cond</span></code>, <code class="docutils literal notranslate"><span class="pre">delay</span></code>, <code class="docutils literal notranslate"><span class="pre">force</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;scheduler_task</span></code> (a.k.a. <a class="reference external" href="https://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node59.html">special forms</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Fexpr">fexpr</a>).</p></li>
<li><p>redun is like Lisp in that higher level constructs like <code class="docutils literal notranslate"><span class="pre">catch</span></code> and <code class="docutils literal notranslate"><span class="pre">cond</span></code> are defined using lower-level features like <code class="docutils literal notranslate"><span class="pre">&#64;scheduler_task</span></code>. This allows users to extend the workflow language similar to extending Lisp using macros.</p></li>
</ul>
</li>
<li><p>Build systems: <a class="reference external" href="https://redo.readthedocs.io/en/latest/">redo</a>, <a class="reference external" href="https://dl.acm.org/doi/10.1145/3236774">Build systems a la Carte</a></p>
<ul>
<li><p>redo shows how the build steps (“tasks” in redun’s terminology) can be arbitrary code that does not require static analysis of its dependencies (child task calls). Instead, when running a workflow for the first time you have to run everything anyway, so just run it. However, if one carefully records what was run (i.e. the data provenance Call Graph in redun) then you can consult the recording in future executions to decide what needs to be incrementally re-executed.</p></li>
<li><p>Build systems as described in “Build systems a la Carte” correspond to pull-style workflow engines (i.e. request a final target/file to be built). A general enough push-style workflow engine (i.e. give input arguments to a workflow) can implement pull-style and thus many build systems. Using the author’s terminology, redun can implement the suspending constructive trace-based build system. Using task option <code class="docutils literal notranslate"><span class="pre">check_valid=&quot;shallow&quot;</span></code>, one can also implement the deep constructive trace rebuilding strategy. Because redun’s tasks can return additional tasks, they are most similar to Monadic tasks.</p></li>
</ul>
</li>
<li><p>Observability, distributed tracing: <a class="reference external" href="https://docs.lightstep.com/docs/understand-distributed-tracing#spans-and-traces">Spans</a></p>
<ul>
<li><p>Span trees play a similar role to redun’s Call Graph. Span attributes are equivalent to redun’s tag system.</p></li>
<li><p>redun’s Call Graphs should provide similar observability and debugging capabilities as span trees. One difference is that Call Graphs are intended to be retained long term in order to provide data provenance. In some ways, observability is like short-term data provenance.</p></li>
<li><p>redun’s Call Graph gives more attention to dataflow between Jobs than Spans typically do.</p></li>
</ul>
</li>
<li><p>Source control: <a class="reference external" href="https://git-scm.com/">git</a></p>
<ul>
<li><p>git provided several inspirations to redun. First, it is easy to get started with git, because users can simply run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">init</span></code> to create a new local repo in the hidden directory <code class="docutils literal notranslate"><span class="pre">.git/</span></code>. Central configuration and coordination is not needed. As users change their code, they record each change using commands like <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code>. This can be seen as a form of provenance but for code, and the <a class="reference external" href="https://krishnabiradar.com/blogs/deconstructing-a-git-commit/">commit graph</a> is git’s data structure for storing this provenance information. The commit graph is a <a class="reference external" href="https://en.wikipedia.org/wiki/Merkle_tree">Merkle tree</a> that uses hashes to give unique ids to each node in the graph and this enables efficient peer-to-peer syncing of commit graphs between repos using the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code> commands. git provides many additional tools, such as <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code>, for inspecting commit graphs to help with the code development process.</p></li>
<li><p>To relate this to redun, redun also creates a local repo in <code class="docutils literal notranslate"><span class="pre">.redun/</span></code> on the first workflow run or with a <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">init</span></code> command. New data provenance is recorded each time users use the <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">run</span></code> command. These recordings are stored in the Call Graph data structure, which is also a Merkle tree. Users can sync Call Graphs efficiently using the <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">push</span></code> and <code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">pull</span></code> commands. redun also provides tools for using Call Graphs in the development process, such as exploring past executions (<code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">log</span></code>), figuring out the difference between two executions (<code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">diff</span></code>), and interactively exploring Call Graphs and data (<code class="docutils literal notranslate"><span class="pre">redun</span> <span class="pre">repl</span></code>).</p></li>
</ul>
</li>
<li><p>ML frameworks: <a class="reference external" href="https://www.tensorflow.org/">TensorFlow</a>, <a class="reference external" href="https://pytorch.org/">PyTorch</a></p>
<ul>
<li><p>ML frameworks can be thought of as workflow engines for tensors. They face similar issues for reifying computation so that they can automatically parallelize, distribute, and differentiate the compute described by a network. TensorFlow’s original Graph API required the network to be constructed upfront as a static directed acyclic graph (DAG), while TensorFlow and PyTorch’s eager execution APIs allow in-line compute graph definition during forward pass. In comparison, redun operates between these two extremes. In redun, task calls are always lazy, which produces an upfront graph of compute (an expression graph). However, tasks can return additional expressions, thus allowing the user to interleave static DAGs with arbitrary Python code. This allows redun to express very dynamic compute without the downsides of fully eager execution: constant access to a central scheduler, difficult to define checkpoints, data provenance gaps, etc.</p></li>
<li><p>Redun’s data provenance graph is also related to the tape-based automatic differentiation (often called autograd) in <a class="reference external" href="https://pytorch.org/tutorials/beginner/former_torchies/autograd_tutorial.html">Pytorch</a> and <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/GradientTape">TensorFlow</a>. Specifically, redun performs call graph recording, which tracks the lineage of task executions and emitted values, similar to the recording of mathematical operators applied to the input during the forward pass of compute graphs in PyTorch/TensorFlow. The recorded redun call graph can then be recursively queried to examine the lineage of an output value, analogous to how ML frameworks recurse over the gradient tape to calculate derivatives of a compute graph’s execution.</p></li>
</ul>
</li>
<li><p>Database migration frameworks: <a class="reference external" href="https://alembic.sqlalchemy.org/">Alembic</a>, <a class="reference external" href="https://docs.djangoproject.com/en/3.2/topics/migrations/">Django migrations</a></p>
<ul>
<li><p>Migration frameworks are used to alter databases (both schemas and data) in a controlled manner. Frameworks, such as Alembic and Django migrations, encourage users to represent their migrations as atomic scripts arranged into a dependency DAG. The frameworks then provide command-line tools for upgrading and downgrading the database to a specific version node within the migration DAG. Such tools then execute the necessary migrations in topological sort order. In order to not apply the same migration twice, these frameworks often maintain a metadata table within the database. In a way, these frameworks are workflow engines with the same usual features of task dependency DAGs and caching logic.</p></li>
<li><p>One difference though, is that migration frameworks also encourage users to define an inverse for each “task”, that is each upgrade migration has a corresponding downgrade. When given a desired migration node version, these CLI tools may apply a combination of upgrade and downgrade migrations to move the database along a path in the migration DAG.</p></li>
<li><p>redun has an experimental feature called <code class="docutils literal notranslate"><span class="pre">Handle</span></code> for defining interactions with stateful services such as databases. redun must record similar metadata about the past states of the Handle and it is envisioned that inverse tasks, or rollbacks, could be defined and executed as needed.</p></li>
</ul>
</li>
<li><p>Causal hashing: <a class="reference external" href="https://arxiv.org/abs/1901.01908">Koji</a></p>
<ul>
<li><p>The Koji paper describes a way of using causal hashing to unify both file and web service use within a single workflow engine system. redun also aims for similar unification and provides a special Value type, Handle, for interacting with external services, such as databases and APIs. Handles solve the problem of giving a unique id to the state of an external system. When the external data source is a simple file, we can hash the file to give its state a unique id. However, when the external data source is a database, it is likely unreasonable to hash a whole database or web service. Instead, a causal hash can be defined as hashing the series of Call Nodes a Handle has passed through. This often gives an equally unique id for the state of an external service, while being more efficient.</p></li>
</ul>
</li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="values.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Values</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, insitro
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Design overview</a><ul>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#first-example">First example</a></li>
<li><a class="reference internal" href="#key-features">Key features</a><ul>
<li><a class="reference internal" href="#memoization-and-reactivity">Memoization and reactivity</a></li>
<li><a class="reference internal" href="#lazy-evaluation-and-parallelism">Lazy evaluation and parallelism</a></li>
<li><a class="reference internal" href="#tasks-as-pure-functions">Tasks as pure functions</a></li>
<li><a class="reference internal" href="#result-caching">Result caching</a></li>
<li><a class="reference internal" href="#file-reactivity">File reactivity</a></li>
<li><a class="reference internal" href="#shell-scripting">Shell scripting</a><ul>
<li><a class="reference internal" href="#script-tasks">Script tasks</a></li>
<li><a class="reference internal" href="#file-staging">File staging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#provenance-and-call-graphs">Provenance and call graphs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-topics">Advanced topics</a><ul>
<li><a class="reference internal" href="#working-with-databases-and-apis">Working with databases and APIs</a></li>
<li><a class="reference internal" href="#running-without-a-scheduler">Running without a scheduler</a></li>
<li><a class="reference internal" href="#connections-to-functional-programming">Connections to functional programming</a></li>
<li><a class="reference internal" href="#redun-a-language-within">redun: a language within</a></li>
</ul>
</li>
<li><a class="reference internal" href="#influences">Influences</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>